<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teacher/Class/Student List</title>
  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    /* İhtiyaç duyulursa CSS stilleri eklenebilir */
  </style>
</head>
<body>
  <div class="flex flex-col justify-center items-center mt-10">
    <h1 class="text-2xl font-bold mb-4">Teachers</h1>
    <select id="teacherSelect" class="p-2 border border-gray-300 rounded mb-4">
      <!-- Öğretmenlerin seçeneklerini dinamik olarak buraya ekleyeceğiz -->
    </select>

    <div id="coursesContainer" class="hidden">
      <h2 class="text-lg font-bold mb-2">Courses</h2>
      <div id="courseList"></div>
    </div>

    <div id="studentsContainer" class="hidden">
      <h2 class="text-lg font-bold mb-2">Students</h2>
      <ul id="studentList"></ul>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('fetchTeacherClassStudentList').addEventListener('click', function() {
            fetchTeachers();
        });
    });
    
    function fetchTeachers() {
        fetch('/fetch_teachers')
        .then(response => response.json())
        .then(data => {
            displayTeachers(data.teachers);
        })
        .catch(error => {
            console.error('Error fetching teachers:', error);
        });
    }
    
    function displayTeachers(teachers) {
        var teacherSelect = document.getElementById('teacherSelect');
        teacherSelect.innerHTML = '';
    
        teachers.forEach(teacher => {
            var option = document.createElement('option');
            option.textContent = teacher.teacher_name + ' ' + teacher.teacher_surname;
            option.value = teacher.teacher_id;
            teacherSelect.appendChild(option);
        });
        
        teacherSelect.addEventListener('change', function() {
            var selectedTeacherId = this.value;
            if(selectedTeacherId !== '') {
                fetchCoursesByTeacher(selectedTeacherId);
            }
        });
    }
    
    function fetchCoursesByTeacher(teacherId) {
        fetch('/fetch_courses_by_teacher', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({teacher_id: teacherId})
        })
        .then(response => response.json())
        .then(data => {
            displayCourses(data.courses);
        })
        .catch(error => {
            console.error('Error fetching courses by teacher:', error);
        });
    }
    
    function displayCourses(courses) {
        var courseListElement = document.getElementById('courseList');
        courseListElement.innerHTML = '';
    
        courses.forEach(course => {
            var listItem = document.createElement('li');
            listItem.textContent = course.course_name;
            courseListElement.appendChild(listItem);
    
            listItem.addEventListener('click', function() {
                fetchStudentsByCourse(course.course_id);
            });
        });

        document.getElementById('coursesContainer').classList.remove('hidden');
    }
    
    function fetchStudentsByCourse(courseId) {
        fetch('/fetch_students_by_course', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({course_id: courseId})
        })
        .then(response => response.json())
        .then(data => {
            displayStudents(data.students);
        })
        .catch(error => {
            console.error('Error fetching students by course:', error);
        });
    }
    
    function displayStudents(students) {
        var studentListElement = document.getElementById('studentList');
        studentListElement.innerHTML = '';
    
        students.forEach(student => {
            var listItem = document.createElement('li');
            listItem.textContent = student.student_name + ' ' + student.student_surname;
            studentListElement.appendChild(listItem);
        });

        document.getElementById('studentsContainer').classList.remove('hidden');
    }
</script>

</body>
</html>
